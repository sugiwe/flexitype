# 2025-12-02 の日報（Day 2）

## 本日の目標

- Rails新規プロジェクトの作成
- GitHubリポジトリの作成と接続
- 日報管理の仕組みを整備
- 可能であれば認証機能の基本実装まで進める

## 実施内容

### 環境確認

- Ruby 3.4.4、Rails 8.1.1が導入済みを確認
- PostgreSQL 17.5が導入済みを確認
- GitHub CLI (gh)が利用可能で、sugieweアカウントでログイン済み

### プロジェクトセットアップ

- `docs/daily_reports/` ディレクトリを作成し、日報用のREADMEとテンプレートを準備
- PostgreSQLを使用したRails 8.1.1プロジェクトを生成
  - Hotwire (Turbo + Stimulus)が自動的に導入される
  - Kamalの設定ファイルも自動生成される
- CLAUDE.mdをプロジェクトルートに配置
- PostgreSQLのdevelopment/testデータベースを作成

### バージョン管理とGitHub連携

- Gitリポジトリを初期化し、初回コミットを実施
- GitHub CLIを使用して `flexitype` リポジトリを作成
- ローカルリポジトリとリモートリポジトリを接続し、初回プッシュを完了

リポジトリURL: https://github.com/sugiwe/flexitype

### ホームページの作成

- Homeコントローラとindexアクションを生成
- ルートパス(`/`)を`home#index`に設定
- FlexiTypeのシンプルなトップページを作成

### Tailwind CSSとSlimの導入

- `tailwindcss-rails` gemを追加してTailwind CSS v4をセットアップ
- `slim-rails` gemを追加してSlimテンプレートエンジンを導入
- ERBビュー（レイアウト、ホームページ）をSlim形式に変換
- `Procfile.dev`を作成し、`bin/dev`でTailwindビルドとサーバーを同時起動可能に

### Google Identity Servicesによる認証実装

#### 技術選定の変更

- 当初はOmniAuthを検討していたが、より新しいGoogle Identity Services方式に変更
- OmniAuthだと`failure`アクションが必要だが、Google Identity Servicesならよりシンプルに実装可能

#### 実装内容

- `google-id-token` gemを追加してIDトークン検証を実装
- Userモデルを作成
  - カラム: `google_uid`（not null, unique）、`email`（not null, unique）、`name`
  - バリデーション: google_uid, email の存在性と一意性
  - `from_google` メソッド: IDトークンからユーザーを検索/作成
  - `email_allowed?` メソッド: メール許可リストチェック
- マイグレーション実行とインデックス追加

#### SessionsController

- `create`アクション: IDトークン検証、許可リストチェック、ログイン処理
- `destroy`アクション: ログアウト処理

#### ApplicationController

- `current_user` ヘルパーメソッド追加
- `logged_in?` ヘルパーメソッド追加

#### メール許可リスト機能

- 環境変数 `ALLOWED_EMAILS`（カンマ区切り）で許可するメールアドレスを管理
- `config/application.rb` で読み込み
- 許可リストが空の場合は全員許可（開発時用）
- 本番環境では許可されたメールアドレスのみログイン可能

#### フロントエンド

- レイアウトにGoogle Identity Servicesのスクリプトを追加
- ホームページにログイン/ログアウトボタンを配置
- ログイン状態に応じた表示切り替え

### Google Cloud Consoleの設定（途中まで）

- Google Cloud Consoleにアクセス
- OAuth同意画面の設定まで完了
- 認証情報（Client ID）の作成は次回に持ち越し

## 学んだこと・気づき

### Rails 8の特徴

- `rails new`時に自動的にGitリポジトリが初期化される
- Solid Cache、Solid Queue、Solid Cableなど新機能が最初から含まれている
- Kamalの設定ファイルも自動生成され、デプロイの準備がスムーズ

### GitHub CLI

- `gh repo create`コマンドを使えば、リポジトリ作成からプッシュまで1コマンドで完了できる
- 非常に便利で、今後も活用したい

### OmniAuth vs Google Identity Services

- OmniAuthは古典的なサーバーサイドリダイレクト方式
  - メリット: シンプル、広く使われている
  - デメリット: `failure`アクションなど余分なコードが必要
- Google Identity Servicesは新しいクライアントサイド方式
  - メリット: モダン、よりシンプルなコード、Googleの推奨方式
  - デメリット: JavaScriptが必要、情報が少ない

### Slim + Tailwind CSS

- SlimはERBより記述量が少なく、可読性が高い
- Tailwind CSSはユーティリティクラスで素早くスタイリング可能
- 両方とも初めての採用だが、思ったよりスムーズに導入できた

## 技術的な課題・解決方法

### 問題: Googleログインボタンを押すとエラー

- エラー内容: `Error 401: invalid_client`
- 原因: Google Cloud ConsoleでOAuth 2.0クライアントIDをまだ作成していない
- 解決: 次回、Google Cloud Consoleで認証情報を設定する必要がある

## 明日の予定

- Google Cloud Consoleで認証情報（Client ID/Secret）を作成
- Railsのcredentials.ymlにClient IDとSecretを設定
- Googleログイン機能の動作確認
- ログイン後の画面遷移を整理
- 余裕があればUserモデルのテストを追加

## 所感

Day 2として、想定以上に多くのことを進められた。Rails newからGitHub連携、Tailwind CSS・Slimの導入、そしてGoogle認証の基本実装まで完了。

特に、Google Identity Servicesの採用は良い判断だったと感じる。OmniAuthより新しく、コードもシンプルになった。feeeedのコードを参考にしながら実装できたのも大きい。

Slim記法もTailwind CSSも初めてだったが、思ったより直感的で書きやすい。特にSlimはインデントベースで、HTMLの閉じタグが不要なのが気持ち良い。

明日はGoogle Cloud Consoleの設定を完了させて、実際にログインできるところまで確認したい。Phase 1（基盤構築）を確実に完了させる。

コミット数: 5回
GitHub: https://github.com/sugiwe/flexitype
